
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>청년버팀목대출 계산기</title>

<style>
  body {
    margin: 0;
    background: #f2f4f6;
    font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
  }

  .wrap {
    max-width: 480px;
    margin: 0 auto;
    padding: 20px;
  }

  .card {
    background: #fff;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,.06);
    margin-bottom: 16px;
  }

  h1 { font-size: 20px; margin-bottom: 6px; }
  .sub { font-size: 13px; color: #777; margin-bottom: 16px; }

  label { font-size: 13px; color: #555; display: block; margin-top: 12px; }

  input {
    width: 100%;
    padding: 14px;
    margin-top: 6px;
    font-size: 15px;
    border-radius: 12px;
    border: 1px solid #ddd;
    box-sizing: border-box;
margin-bottom: 2px;
  }

  .check-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 12px;
  }

.check-item {
  display: flex;
  align-items: center;
  gap: 8px;
cursor: pointer;
}

.check-item input {
  width: auto;     
  padding: 0;
  margin: 0;
margin-right: 0;
  flex-shrink: 0;
}

.check-item span {
  flex: 1;
  word-break: keep-all;
cursor: pointer;
}

  button {
    width: 100%;
    margin-top: 20px;
    padding: 16px;
    border: none;
    border-radius: 14px;
    background: #2d7cff;
    color: #fff;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
  }

  .warn {
    color: #e33;
    font-size: 13px;
    margin-top: 10px;
    min-height: 18px;
  }

  .result {
display: none;
    background: #f0f8ff;
    border-radius: 16px;
    padding: 20px;
    margin-top: 16px;
    opacity: 0;
    transform: scale(0.96);
    transition: all 0.25s ease;
  }

  .result.show {
    opacity: 1;
    transform: scale(1);
  }

.highlight {
  font-size: 34px;
  font-weight: 900;
  color: #2d7cff;
  margin-bottom: 16px;
  letter-spacing: -0.5px;
}

  .result div {
    margin: 6px 0;
    font-size: 15px;
  }

  .blog-note {
    font-size: 12px;
    color: #555;
    margin-top: 14px;
    line-height: 1.5;
  }

  .blog-note a {
    color: #2d7cff;
    font-weight: 600;
    text-decoration: none;
  }

.unit-text {
  font-size: 12px;
  color: #2d7cff;
  margin-top: 4px;
  font-weight: 600;
display: block;
  padding-left: 4px;
}

#shareBtn {
  margin-top: 14px;
  padding: 14px;
  width: 100%;
  border-radius: 12px;
  border: 1px solid #2d7cff;
  background: #fff;
  color: #2d7cff;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
}

</style>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

</head>

<body>
<div class="wrap">

  <div class="card">
    <h1>청년버팀목대출 계산기</h1>
    <div class="sub">내 조건이면 월 이자 얼마나 나올까?</div>

    <label>연소득 (원)</label>
    <input id="income" type="text" placeholder="예: 40,000,000" />
<div class="unit-text" id="incomeUnit"></div>

    <label>전세금 (원)</label>
    <input id="jeonse" type="text" placeholder="예: 130,000,000" />
<div class="unit-text" id="jeonseUnit"></div>

    <label>자녀수 (명)</label>
<input id="children" type="number" min="0" step="1" placeholder="예: 1" />

    <label>금리 우대</label>
<div class="check-group">

  <div class="check-item">
    <input type="checkbox" id="basic">
    <span>기초·차상위</span>
  </div>

  <div class="check-item">
    <input type="checkbox" id="single">
    <span>한부모가구</span>
  </div>

  <div class="check-item">
    <input type="checkbox" id="weak">
    <span>취약가구</span>
  </div>

  <div class="check-item">
    <input type="checkbox" id="rent">
    <span>월세 성실납부</span>
  </div>

  <div class="check-item">
    <input type="checkbox" id="econtract">
    <span>전자계약</span>
  </div>

  <div class="check-item">
    <input type="checkbox" id="young">
    <span>25세 미만 단독</span>
  </div>

  <div class="check-item">
    <input type="checkbox" id="company">
    <span>중소기업 청년</span>
  </div>

  <div class="check-item">
    <input type="checkbox" id="thirty">
    <span>대출 30% 이하</span>
  </div>

  <div class="check-item">
    <input type="checkbox" id="local">
    <span>지방 주택</span>
  </div>

</div>

    <button onclick="calc()">계산하기</button>
<button style="background:#eee;color:#555" onclick="resetForm()">초기화</button>
    <div class="warn" id="warn"></div>
  </div>

  <div class="card result" id="result">
    <div class="highlight">월 이자 <span id="interest"></span></div>
    <div>기준금리: <span id="baseRate"></span></div>
    <div>우대금리: <span id="discountRate"></span></div>
    <div>최종금리: <span id="finalRate"></span></div>
    <div>본인 투입금액: <span id="selfMoney"></span></div>
    <div id="detail"></div>
<div id="discountNote" class="blog-note" style="display:none; color:#e33;">
  ※ 우대금리는 조건별 최대 한도까지만 적용됩니다.
</div>

<button id="shareBtn" onclick="shareResult()">결과 공유하기</button>

<button id="captureBtn" style="margin-top:8px" onclick="saveImage()">
  결과 이미지로 저장
</button>

    <div class="blog-note">
      본 계산기는 <strong>일시상환 기준 참고용</strong>입니다.<br>
      실제 대출 가능 금액·금리는 은행 심사 결과에 따라 달라질 수 있으며,
      계산 기준 및 상세 설명은
      <a href="https://m.blog.naver.com/mooonda" target="_blank">블로그</a>에서 확인해 주세요.
    </div>
  </div>

</div>

<script>

function formatUnit(v){
  if(!v) return "";

  // 1억 이상 → 억 단위 (소수 2자리, 불필요한 0 제거)
  if(v >= 100000000){
    return (v / 100000000)
      .toFixed(2)
      .replace(/\.00$/,"")
      .replace(/(\.\d)0$/,"$1") + "억 원";
  }

  // 1억 미만 → 만 단위 + 콤마
  return Math.floor(v / 10000).toLocaleString() + "만 원";
}

function getBaseRate(income){
  if(income <= 20000000) return 2.0;
  if(income <= 40000000) return 2.5;
  if(income <= 60000000) return 2.9;
  return 3.1;
}

const comma = n => n.toLocaleString();

["income","jeonse"].forEach(id=>{
  const input = document.getElementById(id);
  const unit = document.getElementById(id + "Unit");

  input.addEventListener("input", e=>{
    let v = e.target.value.replace(/[^0-9]/g,"");
    if(!v){
      input.value = "";
      unit.innerText = "";
      return;
    }
    const n = Number(v);
    input.value = comma(n);
    unit.innerText = formatUnit(n);
  });
});

function calc(event){
  const btn = event?.target;
  if(btn) btn.disabled = true;

  const warn = document.getElementById("warn");
  const r = document.getElementById("result");

  warn.innerText = "";
  r.classList.remove("show");

  const incomeVal = Number(income.value.replace(/,/g,""));
  const jeonseVal = Number(jeonse.value.replace(/,/g,""));
  const child = Number(children.value || 0);

  if(!incomeVal || !jeonseVal){
    warn.innerText = "연소득과 전세금을 입력해 주세요";
    if(btn) btn.disabled = false;
    return;
  }

  if(incomeVal > 75000000 || jeonseVal > 300000000){
    warn.innerText = "연소득 7,500만원 또는 전세금 3억원 초과 시 계산 불가";
    if(btn) btn.disabled = false;
    return;
  }

  let base = getBaseRate(incomeVal);
  let discount = 0;
  let applied = [];
  let candidates = [];

  if(basic.checked && incomeVal <= 40000000) candidates.push({v:1.0,t:"기초·차상위"});
  if(single.checked && incomeVal <= 50000000) candidates.push({v:1.0,t:"한부모"});
  if(weak.checked) candidates.push({v:0.2,t:"취약가구"});
  if(child>=1){
    const v = child===1?0.3:child===2?0.5:0.7;
    candidates.push({v,t:`다자녀(${child}명)`});
  }

  if(candidates.length){
    candidates.sort((a,b)=>b.v-a.v);
    discount += candidates[0].v;
    applied.push(candidates[0].t);
  }

  if(rent.checked){discount+=0.2; applied.push("월세 성실납부");}
  if(econtract.checked){discount+=0.1; applied.push("전자계약");}
  if(young.checked){discount+=0.3; applied.push("25세 미만 단독");}
  if(company.checked){discount+=0.3; applied.push("중소기업 청년");}
  if(thirty.checked){discount+=0.2; applied.push("대출 30% 이하");}
  if(local.checked){discount+=0.2; applied.push("지방 주택");}

  let max = 0.5;
  if(applied.includes("기초·차상위") || applied.includes("한부모")) max = 1.0;
  else if(child>=1) max = 0.7;
  discount = Math.min(discount, max);

  const note = document.getElementById("discountNote");
  const rawDiscount = candidates.reduce((s,c)=>s+c.v,0);
  note.style.display = rawDiscount > max ? "block" : "none";

  let final = Math.max(base - discount, 1.0);

  let loan = Math.min(jeonseVal * 0.8, 150000000);
  const monthly = Math.floor((loan * (final / 100)) / 12);

  interest.innerText = comma(monthly) + "원";
  baseRate.innerText = base.toFixed(1) + "%";
  discountRate.innerText = discount.toFixed(1) + "%p";
  finalRate.innerText = final.toFixed(1) + "%";
  selfMoney.innerText = comma(jeonseVal - loan) + "원";
  detail.innerText = "우대 적용: " + (applied.length ? applied.join(", ") : "없음");

  r.style.display = "block";

  setTimeout(()=>{
    r.classList.add("show");
    window.scrollTo({top:r.offsetTop-12, behavior:"smooth"});
  },120);

  if(btn){
    setTimeout(()=>{ btn.disabled = false; }, 300);
  }

  updateURL(incomeVal, jeonseVal, child);
}

function resetForm(){
 ["income","jeonse","children"].forEach(id=>{
    document.getElementById(id).value = "";
    const u = document.getElementById(id+"Unit");
    if(u) u.innerText = "";
  });

document.querySelectorAll("input[type=checkbox]").forEach(c=>c.checked=false);
 document.getElementById("result").classList.remove("show");
document.getElementById("result").style.display = "none";

  document.getElementById("warn").innerText = "";
  history.replaceState(null,"",location.pathname);
}

function saveImage(){
  const card = document.getElementById("result");
  const buttons = card.querySelectorAll("button");

  buttons.forEach(b=>b.style.display="none");

  html2canvas(card).then(canvas=>{
    const ctx = canvas.getContext("2d");

    ctx.font = "12px Apple SD Gothic Neo";
    ctx.fillStyle = "#666";
    ctx.fillText("ⓒ 청년버팀목대출 계산기 · mooonda", 12, canvas.height - 12);

    buttons.forEach(b=>b.style.display="block");

    const link = document.createElement("a");
    link.download = "청년버팀목대출_계산결과.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}

function shareResult(){
  const url = location.href;

  if(navigator.share){
    navigator.share({
  title: "청년버팀목대출 계산기",
  text: "내 조건 기준 월 이자 계산 결과입니다",
  url
});
  } else {
    navigator.clipboard.writeText(url).then(()=>{
      alert("결과 링크가 복사되었습니다");
    });
  }
}

function updateURL(income, jeonse, child){
  const checks = {};
  document.querySelectorAll(".check-group input").forEach(c=>{
    checks[c.id] = c.checked ? 1 : 0;
  });

  const params = new URLSearchParams({
    income,
    jeonse,
    child,
    ...checks
  });

history.replaceState(null,"","?"+params.toString());
}

function loadFromURL(){
  const p = new URLSearchParams(location.search);
  if(!p.has("income")) return;

  income.value = comma(+p.get("income"));
  jeonse.value = comma(+p.get("jeonse"));
  children.value = p.get("child") || "";

  incomeUnit.innerText = formatUnit(+p.get("income"));
  jeonseUnit.innerText = formatUnit(+p.get("jeonse"));

document.querySelectorAll(".check-group input").forEach(c=>{
  if(p.has(c.id)) c.checked = p.get(c.id) === "1";
});

  calc();
}

window.addEventListener("load", loadFromURL);

</script>
</body>
</html>
