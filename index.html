<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>★청년버팀목대출 월 이자금액 계산기</title>
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
    input[type="text"], input[type="number"] { font-size: 18px; padding: 8px; width: 100%; margin-bottom: 10px; }
    label { display: block; margin: 5px 0; }
    button { font-size: 18px; padding: 10px; margin-top: 10px; width: 100%; }
    .result { margin-top: 20px; font-size: 20px; font-weight: bold; white-space: pre-line; }
  </style>
</head>
<body>

<h2>★청년버팀목대출 월 이자금액 계산기</h2>

<label>연소득 (부부합산, 원)</label>
<input id="b3" type="text" placeholder="예: 5,000만" oninput="formatCurrency(this)">

<label>전세금 (원)</label>
<input id="b4" type="text" placeholder="예: 2,000만" oninput="formatCurrency(this)">

<label>다자녀가구 (자녀 수 입력)</label>
<input id="b11" type="number" placeholder="자녀 수"><br>

<label><input type="checkbox" id="b6"> 지방 소재 주택</label>
<label><input type="checkbox" id="b8"> 기초생활수급·차상위</label>
<label><input type="checkbox" id="b9"> 한부모가구</label>
<label><input type="checkbox" id="b10"> 장애인·다문화·노인부양·고령자가구</label>
<label><input type="checkbox" id="b13"> 주거안정 월세대출 성실납부</label>
<label><input type="checkbox" id="b14"> 부동산 전자계약</label>
<label><input type="checkbox" id="b15"> 만 25세 미만 단독세대주</label>
<label><input type="checkbox" id="b16"> 중소기업 취업·창업 청년</label>
<label><input type="checkbox" id="b17"> 대출신청금액이 30% 이하</label>

<button onclick="calc()">계산하기</button>

<h2 class="result" id="result"></h2>

<script>
// B3, B4 입력시 천 단위 쉼표 표시
function formatCurrency(input) {
  let num = input.value.replace(/[^0-9]/g,'');
  input.value = num.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

async function calc() {
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzGNZnXwUjSw2ZeUGzXNxNH-RE1Y9_7CsYbB4nJZTWEfJhyspMXuYF96Byxxy9l0-DrHg/exec";

  const b3Value = Number(document.getElementById('b3').value.replace(/,/g,''));
  const b4Value = Number(document.getElementById('b4').value.replace(/,/g,''));

  // 조건 체크: 연소득 > 7500만 OR 전세금 > 3억 → 결과 안 나옴
  if (b3Value > 75000000 || b4Value > 300000000) {
    document.getElementById("result").innerText = 
      "연소득이 7,500만원 초과이거나 전세금이 3억원 초과하면 계산할 수 없습니다.";
    return;
  }

  const data = {
    b3: b3Value,
    b4: b4Value,
    b11: Number(document.getElementById('b11').value),
    b6: document.getElementById('b6').checked,
    b8: document.getElementById('b8').checked,
    b9: document.getElementById('b9').checked,
    b10: document.getElementById('b10').checked,
    b13: document.getElementById('b13').checked,
    b14: document.getElementById('b14').checked,
    b15: document.getElementById('b15').checked,
    b16: document.getElementById('b16').checked,
    b17: document.getElementById('b17').checked
  };

  try {
    const res = await fetch(WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });

    if (!res.ok) throw new Error("웹앱 호출 실패");

    const json = await res.json();

    // B1 → 정수
    const intResult = Math.round(Number(json.result)).toLocaleString();

    // B29 → NaN 방지, 기본값 0.0%
    let b29 = Number(json.result2);
    if (isNaN(b29)) b29 = 0.0;
    const percentResult = (b29 * 100).toFixed(1) + "%";

    document.getElementById("result").innerText =
      `월 이자금액: ${intResult}원\n대출 금리: ${percentResult}`;
  } catch (err) {
    document.getElementById("result").innerText =
      `계산 불가: 웹앱 URL 확인 필요`;
    console.error(err);
  }
}
</script>

</body>
</html>
