<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>청년버팀목대출 계산기</title>

<style>
  body {
    margin: 0;
    background: #f2f4f6;
    font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
  }

  .wrap {
    max-width: 480px;
    margin: 0 auto;
    padding: 20px;
  }

  .card {
    background: #fff;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,.06);
    margin-bottom: 16px;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(0,0,0,.12);
  }

  h1 { font-size: 20px; margin-bottom: 6px; }
  .sub { font-size: 13px; color: #777; margin-bottom: 16px; }

  label { font-size: 13px; color: #555; display: block; margin-top: 12px; }
  input[type="text"], input[type="number"] {
    width: 100%;
    padding: 14px;
    margin-top: 6px;
    font-size: 15px;
    border-radius: 12px;
    border: 1px solid #ddd;
    box-sizing: border-box;
  }

  .check-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 12px;
  }

  .check-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
  }

  .check-item input {
    width: 18px;
    height: 18px;
  }

  button {
    width: 100%;
    margin-top: 20px;
    padding: 16px;
    border: none;
    border-radius: 14px;
    background: #2d7cff;
    color: #fff;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
  }

  button:active {
    transform: scale(0.98);
  }

  .warn {
    color: #e33;
    font-size: 13px;
    margin-top: 10px;
    min-height: 18px;
  }

  .result {
    background: #f0f8ff;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 12px 28px rgba(0,0,0,.12);
    margin-top: 16px;
    transition: all 0.3s ease;
    transform: scale(0.95);
    opacity: 0;
  }

  .result.show {
    transform: scale(1);
    opacity: 1;
  }

  .highlight {
    font-size: 28px;
    font-weight: 800;
    color: #2d7cff;
    margin-bottom: 12px;
  }

  .result div {
    margin: 6px 0;
    font-size: 15px;
  }

  .blog-note {
    font-size: 12px;
    color: #555;
    margin-top: 12px;
  }

  .blog-note a {
    color: #2d7cff;
    text-decoration: none;
    font-weight: 600;
  }

  footer {
    text-align: center;
    font-size: 12px;
    color: #999;
    margin-top: 12px;
  }

  /* 반응형 */
  @media(max-width: 500px){
    .highlight { font-size: 24px; }
    input[type="text"], input[type="number"] { font-size: 14px; padding: 12px; }
    button { font-size: 15px; padding: 14px; }
  }

  /* 로딩 오버레이 */
  #loadingOverlay {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(255,255,255,0.8);
    z-index: 999;
    justify-content: center;
    align-items: center;
    font-size: 18px;
    font-weight: 700;
    color: #2d7cff;
  }
</style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <h1>청년버팀목대출 계산기</h1>
    <div class="sub">내 조건이면 월 이자 얼마나 나올까?</div>

    <label>연소득 (원)</label>
    <input id="income" type="text" placeholder="예: 40,000,000" />

    <label>전세금 (원)</label>
    <input id="jeonse" type="text" placeholder="예: 130,000,000" />

    <label>자녀수 (명)</label>
    <input id="children" type="number" placeholder="예: 1" />

    <label>금리 우대</label>
    <div class="check-group">
      <div class="check-item"><input type="checkbox" id="basic" />기초·차상위</div>
      <div class="check-item"><input type="checkbox" id="single" />한부모가구</div>
      <div class="check-item"><input type="checkbox" id="weak" />취약가구</div>
      <div class="check-item"><input type="checkbox" id="rent" />월세 성실납부</div>
      <div class="check-item"><input type="checkbox" id="econtract" />전자계약</div>
      <div class="check-item"><input type="checkbox" id="young" />25세 미만 단독</div>
      <div class="check-item"><input type="checkbox" id="company" />중소기업 청년</div>
      <div class="check-item"><input type="checkbox" id="thirty" />대출 30% 이하</div>
      <div class="check-item"><input type="checkbox" id="local" />지방 주택</div>
    </div>

    <button onclick="calc()">계산하기</button>
    <div class="warn" id="warn"></div>
  </div>

  <div class="card result" id="result">
    <div class="highlight">월 이자: <span id="interest"></span></div>
    <div>기본금리: <span id="baseRate"></span></div>
    <div>우대금리: <span id="discountRate"></span></div>
    <div>최종금리: <span id="finalRate"></span></div>
    <div>본인 투입금액: <span id="selfMoney"></span></div>
    <div id="detail"></div>
    <div class="blog-note">
      본 계산기는 참고용이며, 실제 대출 조건과 다를 수 있습니다. 
      정확한 사항과 계산방법은 
      <a href="https://m.blog.naver.com/mooonda" target="_blank">블로그</a>에서 꼭 확인하세요.
    </div>
  </div>

</div>

<div id="loadingOverlay">계산 중...</div>

<footer>© 년기</footer>

<script>
const WEB_APP_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLj6GRxx6W5LXtTXdu_TPVp-HglxTwKDif3TyRJpzpu1nq2jnDsY8IlH4NkTU8mKGXbBszjjXaPf-YGkhiT9WpYJJvjczDP9IbBMr1WHj1y1_Q_hLocYl_cQ8pfA4QNiX3LjBPXOARuq4kodVhHYdx_JyK94TqWQC4yoAQBLc8gtCH2TEmxE2W8VpeteYXmeAN5SJSVizGD3ZACokcnHOU3BBGTXIM9UqyRejZqu41G9MWSTERHwEwuuaV-JAe_PSLS7fWslrNBVkvx-S2_SI589wST5XQ&lib=McujhMwZSXAj5r31WpYZO14Lq-ofEAQ5F";

const comma = n => n.toLocaleString();

["income","jeonse"].forEach(id=>{
  document.getElementById(id).addEventListener("input", e => {
    let v = e.target.value.replace(/[^0-9]/g,"");
    if(v) e.target.value = comma(Number(v));
  });
});

async function calc() {
  const overlay = document.getElementById("loadingOverlay");
  overlay.style.display = "flex"; // 계산 중 표시

  warn.innerText = "";
  const r = document.getElementById("result");

  const incomeVal = Number(income.value.replace(/,/g,""));
  const jeonseVal = Number(jeonse.value.replace(/,/g,""));
  const child = Number(children.value || 0);

  if(incomeVal > 75000000 || jeonseVal > 300000000){
    warn.innerText="연소득 7,500만원 또는 전세금 3억원 초과 시 계산 불가";
    overlay.style.display = "none";
    return;
  }

  try {
    const res = await fetch(WEB_APP_URL);
    const data = await res.json();
    let base = data.baseRate;
    let discount = 0;
    let applied=[];

    let candidates=[];
    if(basic.checked && incomeVal <= 40000000) candidates.push({v:1.0,t:"기초·차상위"});
    if(single.checked && incomeVal <= 50000000) candidates.push({v:1.0,t:"한부모"});
    if(weak.checked) candidates.push({v:0.2,t:"취약가구"});
    if(child>=1){
      const v = child===1?0.3 : child===2?0.5 : 0.7;
      candidates.push({v:v,t:`다자녀(${child}명)`});
    }

    if(candidates.length){
      candidates.sort((a,b)=>b.v-a.v);
      discount += candidates[0].v;
      applied.push(candidates[0].t);
    }

    if(rent.checked){discount+=0.2; applied.push("월세 성실납부");}
    if(econtract.checked){discount+=0.1; applied.push("전자계약");}
    if(young.checked){discount+=0.3; applied.push("25세 미만 단독");}
    if(company.checked){discount+=0.3; applied.push("중소기업 청년");}
    if(thirty.checked){discount+=0.2; applied.push("대출 30% 이하");}
    if(local.checked){discount+=0.2; applied.push("지방 주택");}

    let max=0.5;
    if(applied.includes("기초·차상위") || applied.includes("한부모")) max=1.0;
    else if(child>=1) max=0.7;
    discount=Math.min(discount,max);

    let final = base - discount;
    if(final < 1.0) final = 1.0;

    const loan = jeonseVal * 0.8;
    const selfMoneyCalc = jeonseVal - loan;
    const monthly = Math.floor((loan*(final/100))/12);

    r.querySelector("#interest").innerText = comma(monthly)+"원";
    r.querySelector("#baseRate").innerText = base.toFixed(1)+"%";
    r.querySelector("#discountRate").innerText = discount.toFixed(1)+"%p";
    r.querySelector("#finalRate").innerText = final.toFixed(1)+"%";
    r.querySelector("#selfMoney").innerText = comma(selfMoneyCalc)+"원";
    r.querySelector("#detail").innerText = "우대 적용: " + applied.join(", ");

    // 결과 카드 강조
    r.classList.add("show");
  } catch(err){
    warn.innerText = "계산 중 오류가 발생했습니다.";
  } finally {
    overlay.style.display = "none";
  }
}
</script>
</body>
</html>
